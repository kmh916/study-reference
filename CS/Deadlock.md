# Deadlock

### - [[10분 테코톡] 🥁둔덩의 교착상태](https://youtu.be/FXzBRD3CPlQ)
<details>
<summary>내용 정리</summary>
<div markdown="1">

## 교착 상태 개념
  ### 교착 상태란?
  프로세스나 스레드가 결코 일어날 수 없는 특정 이벤트를 기다리는 상태
  
  예를 들어 프로세스 A와 B가 각각 영상편집,개발 이라는 업무를 수행해야하고 A는 노트북
  B는 노트북 충전기라는 자원을 점유하고 있는데 노트북 배터리가 0이라면 A는 B가 점유하고 있는
  충전기를 사용하기 위해 B의 점유가 끝날때 까지 대기 할 것이고 B는 A가 점유하고있는 노트북을
  사용하기 위해 대기 할 것이므로 해결해주기 전까지 교착 상태에 빠지게 된다.
  ![image](https://user-images.githubusercontent.com/94831670/183322199-cc678ae8-56b0-4e86-b3bd-1654c71a3d62.png)

  #### 실제 교착 상태 예시 - MySQL의 상호 거래 패턴
  ![데드락](https://user-images.githubusercontent.com/94831670/183322593-07d0e480-dec7-486a-ba28-194555b46419.png)

  
  
## 교착 상태 필요 조건
  해당 4가지 조건을 동시에 만족한다면 교착상태에 빠지게 된다.
  ### 상호 배제 조건(mutual exclusion condition)
  - 여러 프로세스가 동시에 한 자원에 접근하지 못하는 조건, 해당 제약이 적용되었기 때문에 
  교착상태의 원인이 된다.
  ### 점유와 대기 조건(hold-and-wait condition)
  - 한 프로세스가 자원을 점유한 상태로 다른 자원을 점유하기 위해 대기 할 수 있기 때문에
  교착상태의 원인이 된다.
  ### 비선점 조건(nopreemption condition)
  - 프로세스에서 자원을 할당 받으면 작업을 완료할때 까지 시스템에서 프로세스의 제어를 
  뺏을 수 없기 때문에 교착상태의 원인이 된다.
  ### 순환 대기 조건(circular-wait condition)
  - 점유와 대기 상태에서 빠져 나갈 수 없기 때문에 교착 상태의 원인이 된다.
  
## 교착 상태 해결법
  ### 교착 상태 예방
  교착 상태 예방 전략은 점유와 대기 조건과 달리 프로세스가 작업에 필요한 모든
  자원을 점유해야만 시작되게 하는 전략이다. 해당 전략을 사용하면 자원을 효율적으로
  사용할 수 없기 때문에 잘 사용하지 않는 교착 상태 해결 전략이다.
 
  ### 교착 상태 회피
  교착 상태 회피 전략은 교착 상태를 인정하고 회피하는 전략이다.
  대표적으로 은행원 알고리즘이 있는데 시스템을 안전 / 불안전 상태로 구분하고
  불안전 상태일 땐 대기 시킨다. 할당할 자원 수 고정, 프로세스 수 고정, 제한된 시간안에
  자원 반납 등 많은 조건이 필요하고 많은 오버헤드가 발생하기 때문에 많은 자원이 
  이동하는 현대 시스템에서는 사실상 불가능한 전략이다. 
  
  ### 교착 상태 탐지 및 복구
  #### 교착 상태 탐지
  교착 상태 탐지 전략은 교착 상태 존재 여부 및 교착 상태에 연관된 프레스와 자원을 알아내고
  순환 대기 조건의 존재 여부에 초점을 맞추는 전략이다.
  탐지 알고리즘은 프로세스와 자원의 연관관계를 그래프로 나타낸 `자원할당 그래프` 에서 자원 노드를 소거하여
  프로세스간의 순환을 탐지한다.
  시스템마다 교착상태 발생 빈도가 다르므로 적은 오버헤드를 위해 시스템마다 
  다른 기준을 가지고 탐지 알고리즘을 호출해야 한다.
  
  #### 교착 상태 복구
  순환 대기를 깨서 교착 상태로부터 회복하는 전략이다. 대표적으로 순환 대기가 깨질 때 까지
  프로세스를 종료시키는 방법과 순환 대기에 포함된 프로세스의 제어권을 뺏고 롤백 시키는 
  방법이 있다. 시스템마다 다른 기준으로 우선 순위에 따라 타겟이 되는 프로세스가 결정된다.
  (남은 수행시간, 자원 유형의 수) 
  예를들어 MySQL에서는 트랜잭션 타임아웃 발생시 작업 크기가 가장 작은 트랜잭션이 롤백된다.
  
  
  
  ### 교착 상태 무시
  교착 상태가 드물게 발생하는 시스템에서 일반적으로 사용하는 방법으로
  교착상태가 드물게 발생하는 시스템에서 교착 상태를 해결하기 위해 비용을 지불하는 것이
  비효율적이므로 교착상태 해결방안을 무시 하는 방법
  
  해당 체계에서 교착 상태가 발생한다면 사용자가 프로세스를 강제로 컨트롤 해야한다.
  
  
</div>
</details>
